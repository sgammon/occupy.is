// Generated by CoffeeScript 1.3.1
(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x=[].slice,y={}.hasOwnProperty,z=function(a,b){function d(){this.constructor=a}for(var c in b)y.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},A=function(a,b){return function(){return a.apply(b,arguments)}},B=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1};this.__apptools_preinit={},v={},q=function(a,b,c){var d,e,f,g,h,i,j,k,l;c==null&&(c=null);if(a===".")return b[b.length-1];k=a.split(/\./),a=k[0],g=2<=k.length?x.call(k,1):[];for(e=h=l=b.length-1;l<=-1?h<-1:h>-1;e=l<=-1?++h:--h){if(b[e]==null)continue;if(typeof b[e]=="object"&&a in(d=b[e])){c=d[a];break}continue}for(i=0,j=g.length;i<j;i++)f=g[i],c=q(f,[c]);return c instanceof Function&&(c=function(a){return function(){var b;return b=a.apply(d,arguments),b instanceof Function&&b.apply(null,arguments)||b}}(c)),c},p=function(){var a,b,c,d;return c=arguments[0],d=arguments[1],a=3<=arguments.length?x.call(arguments,2):[],function(){var e,f,g;g=[];for(e=0,f=d.length;e<f;e++)b=d[e],g.push(b.call.apply(b,[c].concat(x.call(a))));return g}().join("")},s=function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,r,t,u,w,y,z,A,B,C,D,E,F,G,H,I;b==null&&(b=["{{","}}"]),c==null&&(c=null),j=v[F=b.join(" ")]||(v[F]={});if(a in j)return j[a];e=[],d=function(){var a,c;return c=b[0],a=b[1],RegExp("([\\s\\S]*?)([ \\t]*)(?:"+c+"\\s*(?:(!)\\s*([\\s\\S]+?)|(=)\\s*([\\s\\S]+?)\\s*=|({)\\s*(\\w[\\S]*?)\\s*}|([^0-9a-zA-Z._!={]?)\\s*([\\w.][\\S]*?))\\s*"+a+")","gm")},B=d(),B.lastIndex=y=(c||{start:0}).start,w=function(b,c){var d,e,f,g,h,i,j,k,m,n,o;(f=/$/gm).lastIndex=b,f.exec(a),n=a.substr(0,b).split("\n"),m=n.length,j=n[m-1],o=l+E.length,k=a.substr(o+1,b-o-1),h=(new Array(j.length-k.length+1)).join(" "),d=(new Array(k.length+1)).join("^"),j+=a.substr(b,f.lastIndex-b),g=new Error;for(i in e={message:""+c+"\n\nLine "+m+":\n"+j+"\n"+h+d,error:c,line:m,"char":h.length,tag:k})g[i]=e[i];return g};while(t=B.exec(a)){G=t.slice(1,3),k=G[0],E=G[1],D=t[3]||t[5]||t[7]||t[9],A=t[4]||t[6]||t[8]||t[10],l=y+k.length-1,y=B.lastIndex,r=(l===-1||a.charAt(l)==="\n")&&((H=a.charAt(y))===void 0||H===""||H==="\r"||H==="\n"),k&&e.push(function(a){return function(){return a}}(k)),r&&D!==""&&D!=="&"&&D!=="{"?(a.charAt(y)==="\r"&&(y+=1),a.charAt(y)==="\n"&&(y+=1)):E&&(e.push(function(a){return function(){return a}}(E)),l+=E.length,E="");switch(D){case"!":break;case"":case"&":case"{":f=function(a,b){return function(c){var d,e;return(d=(e=q(a,c))!=null?e:"")instanceof Function&&(d=p.apply(null,[this,s(""+d())].concat(x.call(arguments)))),b||(d=this.escape(""+d)),""+d}},e.push(f(A,D));break;case">":h=function(a,b){return function(c,d){var e;return e=d(a).toString(),b&&(e=e.replace(/^(?=.)/gm,b)),p.apply(null,[this,s(e)].concat(x.call(arguments)))}},e.push(h(A,E));break;case"#":case"^":z={name:A,start:y,error:w(B.lastIndex,"Unclosed section '"+A+"'!")},I=s(a,b,z),C=I[0],y=I[1],z["#"]=i=function(a,b,c){return function(d){var e,f,g,h;return h=q(a,d)||[],C=h instanceof Function?h(c):c,h instanceof Array||(h=[h]),e=s(C||"",b),d.push(h),f=function(){var a,b,c;c=[];for(a=0,b=h.length;a<b;a++)g=h[a],d[d.length-1]=g,c.push(p.apply(null,[this,e].concat(x.call(arguments))));return c}.apply(this,arguments),d.pop(),f.join("")}},z["^"]=g=function(a,b,c){return function(d){var e;return e=q(a,d)||[],e instanceof Array||(e=[1]),e=e.length===0?s(c,b):[],p.apply(null,[this,e].concat(x.call(arguments)))}},e.push(z[D](A,b,C));break;case"/":c==null?n="End Section tag '"+A+"' found, but not in section!":A!==(u=c.name)&&(n="End Section tag closes '"+A+"'; expected '"+u+"'!");if(n)throw w(B.lastIndex,n);return a=a.slice(c.start,l+1||9e9),j[a]=e,[a,y];case"=":(b=A.split(/\s+/)).length!==2&&(n="Set Delimiters tags should have two and only two values!");if(n)throw w(B.lastIndex,n);o=/[-[\]{}()*+?.,\\^$|#]/g,b=function(){var a,c,d;d=[];for(a=0,c=b.length;a<c;a++)m=b[a],d.push(m.replace(o,"\\$&"));return d}(),B=d();break;default:throw w(B.lastIndex,"Unknown tag type -- "+D)}B.lastIndex=y!=null?y:a.length}if(c!=null)throw c.error;return a.length!==y&&e.push(function(){return a.slice(y)}),j[a]=e},r={VERSION:"1.2.0",helpers:[],partials:null,escape:function(a){var b;return b={"&":"amp",'"':"quot","<":"lt",">":"gt"},a.replace(/[&"<>]/g,function(a){return"&"+b[a]+";"})},render:function(a,b,c){var d;return c==null&&(c=null),(c||(c=this.partials||{}))instanceof Function||(c=function(a){return function(b){if(b in a)return q(b,[a]);throw"Unknown partial '"+b+"'!"}}(c)),d=this.helpers instanceof Array?this.helpers:[this.helpers],p(this,s(a),d.concat([b]),c)}},this.__apptools_preinit!=null?(this.__apptools_preinit.lib={},this.__apptools_preinit.abstract_base_classes=[]):this.__apptools_preinit={lib:{},abstract_base_classes:[]},f=function(){function a(){}return a.name="CoreAPI",a}(),this.__apptools_preinit.abstract_base_classes.push(f),this.Backbone!=null?(this.__apptools_preinit.lib.backbone={enabled:!0,reference:this.Backbone},e=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return z(b,a),b.name="AppToolsView",b}(Backbone.View),c=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return z(b,a),b.name="AppToolsModel",b}(Backbone.Model),d=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return z(b,a),b.name="AppToolsRouter",b}(Backbone.Router),b=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return z(b,a),b.name="AppToolsCollection",b}(Backbone.Collection)):(this.__apptools_preinit.lib.backbone={enabled:!1,reference:null},e=function(){function a(){}return a.name="AppToolsView",a}(),c=function(){function a(){}return a.name="AppToolsModel",a}(),d=function(){function a(){}return a.name="AppToolsRouter",a}(),b=function(){function a(){}return a.name="AppToolsCollection",a}()),this.__apptools_preinit.abstract_base_classes.push(e),this.__apptools_preinit.abstract_base_classes.push(c),this.__apptools_preinit.abstract_base_classes.push(d),this.__apptools_preinit.abstract_base_classes.push(b);if(typeof exports!="undefined"&&exports!==null){for(w in r)exports[w]=r[w];exports.CoreAPI=f,exports.AppToolsView=e,exports.AppToolsModel=c,exports.AppToolsRouter=d,exports.AppToolsCollection=b}else this.Milk=r,this.CoreAPI=f,this.__apptools_preinit.lib.milk={enabled:!0,reference:this.Milk},this.AppToolsView=e,this.AppToolsModel=c,this.AppToolsRouter=d,this.AppToolsCollection=b,this.__AppToolsBaseClasses={AppToolsView:e,AppToolsModel:c,AppToolsRouter:d,AppToolsCollection:b};h=function(a){function b(a,b){this.verbose=A(this.verbose,this),this.error=A(this.error,this),this.log=A(this.log,this),this.setDebug=A(this.setDebug,this),this.config={},this.environment={},this.performance={},this.debug={logging:!0,eventlog:!0,verbose:!0,serverside:!1}}return z(b,a),b.name="CoreDevAPI",b.prototype.setDebug=function(a){return this.debug=a,console.log("[CoreDev] Debug has been set.",this.debug)},b.prototype.log=function(){var a,b,c;c=arguments[0],b=arguments[1],a=3<=arguments.length?x.call(arguments,2):[],a==null&&(a="{no context}"),this.debug.logging===!0&&console.log.apply(console,["["+c+"] INFO: "+b].concat(x.call(a)))},b.prototype.error=function(){var a,b,c;c=arguments[0],b=arguments[1],a=3<=arguments.length?x.call(arguments,2):[],this.debug.logging===!0&&console.log.apply(console,["["+c+"] ERROR: "+b].concat(x.call(a)))},b.prototype.verbose=function(){var a,b,c;c=arguments[0],b=arguments[1],a=3<=arguments.length?x.call(arguments,2):[],this.debug.verbose===!0&&this.log.apply(this,[c,b].concat(x.call(a)))},b}(f),k=function(a){function b(a,b){}return z(b,a),b.name="CoreModelAPI",b}(f),j=function(a){function b(a,b){var c=this;this.registry=[],this.callchain={},this.history=[],this.trigger=function(){var b,d,e,f,g,h,i,j,k,l,m,n,o,p;f=arguments[0],b=2<=arguments.length?x.call(arguments,1):[],a.dev.verbose("Events","Triggered event.",f,b,c.callchain[f]);if(B.call(c.registry,f)>=0){i=0,h=0,g=[],k=[],k.push(f),p=c.callchain[f].hooks;for(l=0,n=p.length;l<n;l++){e=p[l];try{if(e.once===!0&&e.has_run===!0)continue;e.bridge!=null==0?(j=e.fn.apply(e,b),i++,c.history.push({event:f,callback:e,args:b,result:j}),e.has_run=!0):e.bridge===!0&&g.push({event:e.event,args:b})}catch(q){h++,c.history.push({event:f,callback:e,args:b,error:q})}}for(m=0,o=event_bridge.length;m<o;m++)d=event_bridge[m],k.push(d.event),c.trigger.apply(c,[d.event].concat(x.call(d.args)));return{events:k,executed:i,errors:h}}return!1},this.register=function(b){return c.registry.push(b),c.callchain[b]={hooks:[]},a.dev.verbose("Events","Registered event.",b),!0},this.on=this.upon=this.when=this.hook=function(b,d,e){return e==null&&(e=!1),B.call(c.registry,b)<0&&c.register(b),c.callchain[b].hooks.push({fn:d,once:e,has_run:!1,bridge:!1}),a.dev.verbose("Events","Hook registered on event.",b),!0},this.bridge=function(b,d){var e,f,g,h,i;typeof d=="string"&&(d=[d]),typeof b=="string"&&(b=[b]),i=[];for(g=0,h=b.length;g<h;g++)e=b[g],i.push(function(){var b,c,g;g=[];for(b=0,c=d.length;b<c;b++)f=d[b],a.dev.verbose("Events","Bridging events.",e,"->",f),g.push(this.callchain[e].hooks.push({event:f,bridge:!0}));return g}.call(c));return i}}return z(b,a),b.name="CoreEventsAPI",b}(f),g=function(a){function b(a,b){this._data={},this.platform={},this.capabilities={},a.lib.modernizr!=null&&(this.capabilities=a.lib.modernizr),this.capabilities.simple={},this._data={browsers:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:b.opera,identity:"Opera"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],os:[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]}}return z(b,a),b.name="CoreAgentAPI",b.prototype._makeMatch=function(a){var b,c,d,e,f;for(e=0,f=a.length;e<f;e++){d=a[e],c=d.string,b=d.prop,this._data.versionSearchString=d.versionSearch||d.identity;if(c!==null){if(d.string.indexOf(d.subString)!==-1)return d.identity}else if(b)return d.identity}},b.prototype._makeVersion=function(a){var b;b=a.indexOf(this._data.versionSearchString);if(b!==-1)return parseFloat(a.substring(b+this._data.versionSearchString.length+1))},b.prototype.discover=function(){var a,b,c,d,e;a=this._makeMatch(this._data.browsers)||"unknown",e=this._makeVersion(navigator.userAgent)||this._makeVersion(navigator.appVersion)||"unknown",c=this._makeMatch(this._data.os)||"unknown";if(a==="iPod/iPhone"||a==="Android")d="mobile",b=!1;this.platform={os:c,type:d,vendor:navigator.vendor,product:navigator.product,browser:a,version:e,flags:{online:navigator.onLine||!0,mobile:b,webkit:$.browser.webkit,msie:$.browser.msie,opera:$.browser.opera,mozilla:$.browser.mozilla}},this.capabilities.simple.cookies=navigator.cookieEnabled;if(window.jQuery!=null)return this.capabilities.simple.ajax=$.support.ajax},b}(f),i=function(a){function b(a,b){var c=this;this.state={opened:!1,receiving:!1,error:!1,history:{errors:[],received:[]},pending:{},complete:{}},this.init=function(){return c.state.opened=!0,a.dev.verbose("Dispatch","Dispatch startup signal received.")},this.expect=function(b,d,e){return c.state.pending[b]={request:d,callbacks:callbacks,xhr:e},a.dev.verbose("Dispatch","Received EXPECT signal.",b,d,callbacks,e)},this.receive=function(b){var d,e,f,g,h;try{e=JSON.parse(b.data)}catch(i){e=b.data}return a.dev.verbose("Dispatch","Parsed async message.",e),c.state.history.received.push(b),e.status==="ok"?(a.dev.verbose("Dispatch","Triggering deferred success callback."),c.state.complete[e.id]=c.state.pending[e.id],c.state.complete[e.id].response=e,delete c.state.pending[e.id],a.dev.log("RPC","Success",b.data,e.status,c.state.complete[e.id].xhr),a.api.rpc.lastResponse=b.data,a.api.rpc.history[e.id].xhr=c.state.complete[e.id].xhr,a.api.rpc.history[e.id].status=e.status,a.api.rpc.history[e.id].response=b.data,d={xhr:c.state.complete[e.id].xhr,status:e.status,data:b.data},a.events.trigger("RPC_SUCCESS",d),typeof (f=c.state.complete[e.id].callbacks).success=="function"?f.success(e.response.content):void 0):e.status==="notify"?(a.dev.verbose("Dispatch","Received NOTIFY signal."),typeof (g=c.state.pending[e.id].callbacks).notify=="function"?g.notify(e.response.content):void 0):(a.dev.error("Dispatch","Userland deferred task error. Calling error callback.",e),typeof (h=c.state.pending[e.id].callbacks).error=="function"?h.error(e.content):void 0)},this.error=function(b){return c.state.error=!0,c.history.errors.push(b),a.dev.error("Dispatch","Dispatch error state triggered.",b)},this.close=function(){return c.state.opened=!1,c.state.receiving=!1,a.dev.verbose("Dispatch","Dispatch shutdown signal received.")}}return z(b,a),b.name="CoreDispatchAPI",b}(f),n=function(a){function b(a,b){var c=this;a.events.register("STORAGE_INIT"),a.events.register("STORAGE_READY"),a.events.register("STORAGE_ERROR"),a.events.register("STORAGE_ACTIVITY"),a.events.register("COLLECTION_SCAN"),a.events.register("COLLECTION_CREATE"),a.events.register("COLLECTION_DESTROY"),a.events.register("COLLECTION_UPDATE"),a.events.register("COLLECTION_SYNC"),a.events.register("STORAGE_READ"),a.events.register("STORAGE_WRITE"),a.events.register("STORAGE_DELETE"),this._state={runtime:{index:{key_read_tally:{},key_write_tally:{},local_by_key:{},local_by_kind:{}},count:{total_keys:0,by_collection:[],by_kind:[]},data:{}},config:{autoload:!1,autosync:{enabled:!1,interval:120},adapters:{},obfuscate:!1,local_only:!1,callbacks:{ready:null,sync:null}},supervisor:{},cachebridge:{},model_kind_map:{},collection_kind_map:{}},this.internal={check_support:function(a){},bootstrap:function(a){},provision_collection:function(a,b,c){}},this.get=function(){},this.list=function(){},this.count=function(){},this.put=function(){},this.query=function(){},this["delete"]=function(){},this.sync=function(){},this.enable=function(){return a.events.trigger("STORAGE_INIT"),a.events.trigger("STORAGE_READY")},a.events.bridge(["STORAGE_READ","STORAGE_WRITE","STORAGE_DELETE"],"STORAGE_ACTIVITY"),a.events.bridge(["COLLECTION_CREATE","COLLECTION_UPDATE","COLLECTION_DESTROY","COLLECTION_SYNC","COLLECTION_SCAN"],"STORAGE_ACTIVITY")}return z(b,a),b.name="CoreStorageAPI",b}(f),t=function(){function a(a,b,c,d){var e,f,g,h;this.name=a,this.base_uri=b,this.methods=c,this.config=d;if(this.methods.length>0){h=this.methods;for(f=0,g=h.length;f<g;f++)e=h[f],this[e]=this._buildRPCMethod(e,b,d)}}return a.name="RPCAPI",a.prototype._buildRPCMethod=function(a,b,c){var d,e,f=this;return d=this.name,e=function(b,c,e,f,g){return b==null&&(b={}),c==null&&(c=null),e==null&&(e=!1),f==null&&(f=!1),g==null&&(g={}),function(b,c,e,f,g){var h;return h=$.apptools.api.rpc.createRPCRequest({method:a,api:d,params:b||{},opts:g||{},async:e||!1,push:f||!1}),c!==null?h.fulfill(c):h}(b,c,e,f,g)},$.apptools.api.registerAPIMethod(d,a,b,c),e},a}(),u=function(){function a(a,b,c){this.params={},this.action=null,this.method=null,this.api=null,this.base_uri=null,this.envelope={id:null,opts:{},agent:{}},this.ajax={accepts:"application/json",async:!0,cache:!0,global:!0,http_method:"POST",crossDomain:!1,processData:!1,ifModified:!1,dataType:"json",push:!1,contentType:"application/json; charset=utf-8"},a!=null&&(this.envelope.id=a),b!=null&&(this.envelope.opts=b),c!=null&&(this.envelope.agent=c)}return a.name="RPCRequest",a.prototype.fulfill=function(a,b){var c,d,e=this;return a==null&&(a={}),(a!=null?a.success:void 0)==null&&(d=function(a,b,c){return $.apptools.dev.log("RPC","RPC succeeded but had no success callback.",e,a,b,c)},a.success=d),(a!=null?a.failure:void 0)==null&&(c=function(a){return $.apptools.dev.error("RPC","RPC failed but had no failure callback.",e,a)},a.failure=c),$.apptools.api.rpc.fulfillRPCRequest(b,this,a)},a.prototype.setAsync=function(a){var b;return(b=this.ajax)!=null&&b.async==null&&(b.async=a),this},a.prototype.setPush=function(a){return a===!0&&(this.ajax.push=!0,this.envelope.opts.alt="socket",this.envelope.opts.token=$.apptools.push.state.config.token),this},a.prototype.setOpts=function(a){var b,c;return(b=this.envelope)!=null&&(b.opts=_.defaults(a,(c=this.envelope)!=null?c.opts:void 0)),this},a.prototype.setAgent=function(a){var b;return(b=this.envelope)!=null&&b.agent==null&&(b.agent=a),this},a.prototype.setAction=function(a){return this.action=a,this},a.prototype.setMethod=function(a){return this.method=a,this},a.prototype.setAPI=function(a){return this.api=a,this},a.prototype.setBaseURI=function(a){return this.base_uri=a,this},a.prototype.setParams=function(a){return this.params=a!=null?a:{},this},a.prototype.payload=function(){var a;return a={id:this.envelope.id,opts:this.envelope.opts,agent:this.envelope.agent,request:{params:this.params,method:this.method,api:this.api}},a},a}(),m=function(a){function b(a,b){var c,d,e,f,g=this;a.events.register("RPC_CREATE"),a.events.register("RPC_FULFILL"),a.events.register("RPC_SUCCESS"),a.events.register("RPC_ERROR"),a.events.register("RPC_COMPLETE"),a.events.register("RPC_PROGRESS"),this.state={sockets:{enabled:!1,status:"DISCONNECTED","default":null,open:[],closed:[],default_host:((d=a.config)!=null?(e=d.rpc)!=null?e.socket_host:void 0:void 0)!=null||null}},b.amplify!=null&&(a.dev.verbose("RPC","AmplifyJS detected. Registering."),(a!=null?(f=a.sys)!=null?f.drivers:void 0:void 0)&&a.sys.drivers.register("transport","amplify",b.amplify,!0,!0)),this.base_rpc_uri=a.config.rpc.base_uri||"/_api/rpc",this.socket_host=a.config.rpc.socket_host||null,c=$.ajaxSettings.xhr,this.internals={transports:{xhr:{factory:function(){var b;return b=c(),b&&typeof b.addEventListener=="function"&&b.addEventListener("progress",function(b){return a.events.trigger("RPC_PROGRESS",{event:b})},!1),b}},websocket:{factory:function(){var c,d,e,f,h,i;if(a.agent.capabilities.websockets==null)throw a.dev.error("RPC","Socket factory can't produce a socket because the client platform does not support WebSockets."),SocketsNotSupported;if(((e=g.state.sockets)!=null?e.enabled:void 0)!=null==1)return((f=g.state.sockets)!=null?f["default"]:void 0)!=null===null&&((h=g.state.sockets)!=null?(i=h.open)!=null?i.length:void 0:void 0)===0&&(d=new b.WebSocket(g.state.sockets.default_host),d.onopen=a.push.events.on_open,d.onmessage=a.push.events.on_message,d.onclose=a.push.events.on_close,g.state.sockets.open.push(d),g.state.sockets["default"]=d,g.state.sockets.status="CONNECTED"),c={},c}}},config:{headers:{"X-ServiceClient":["AppToolsJS/",[a.sys.version.major.toString(),a.sys.version.minor.toString(),a.sys.version.micro.toString(),a.sys.version.build.toString()].join("."),"-",a.sys.version.release.toString()].join(""),"X-ServiceTransport":"AppTools/JSONRPC"}}},$.ajaxSetup({global:!0,xhr:function(){return g.internals.transports.xhr.factory()},headers:this.internals.config.headers}),this.rpc={lastRequest:null,lastFailure:null,lastResponse:null,history:{},action_prefix:null,alt_push_response:!1,used_ids:[],factory:function(a,b,c,d){return $.apptools.api[a]=new t(a,b,c,d)},_assembleRPCURL:function(a,b,c,d){b==null&&(b=null),c==null&&(c=null),d==null&&(d=null);if(b===null&&d===null)throw"[RPC] Error: Must specify either an API or base URI to generate an RPC endpoint.";return d===null&&(d=$.apptools.api.base_rpc_uri+"/"+b),c!==null?[c+d,a].join("."):[d,a].join(".")},provisionRequestID:function(){var a;return this.used_ids.length>0?(a=Math.max.apply(this,this.used_ids)+1,this.used_ids.push(a),a):(this.used_ids.push(1),1)},decodeRPCResponse:function(a,b,c,d,e){return d(a,b)},createRPCRequest:function(a){var b;return b=new u(this.provisionRequestID()),a.api!=null&&b.setAPI(a.api),a.method!=null&&b.setMethod(a.method),a.agent!=null&&b.setAgent(a.agent),a.opts!=null&&b.setOpts(a.opts),a.base_uri!=null&&b.setBaseURI(a.base_uri),a.params!=null&&b.setParams(a.params),a.async!=null&&b.setAsync(a.async),a.push!=null?b.setPush(a.push):b.setPush(this.alt_push_response),$.apptools.dev.verbose("RPC","New Request",b,a),b.setAction(this._assembleRPCURL(b.method,b.api,this.action_prefix,this.base_rpc_uri)),b},fulfillRPCRequest:function(c,d,e){var f;$.apptools.dev.verbose("RPC","Fulfill",c,d,e),this.lastRequest=d,this.history[d.envelope.id]={request:d,config:c,callbacks:e};if(d.action===null){if(d.method===null)throw"[RPC] Error: Request must specify at least an action or method.";if(d.base_uri===null){if(d.api===null)throw"[RPC] Error: Request must have an API or explicity BASE_URI.";d.action=this._assembleRPCURL(d.method,d.api,this.action_prefix)}else d.action=this._assembleRPCURL(d.method,null,this.action_prefix,d.base_uri)}if(d.action===null||d.action===void 0)throw"[RPC] Error: Could not determine RPC action.";return f={config:c,request:d,callbacks:e},$.apptools.events.trigger("RPC_FULFILL",f),function(c,d){var e,g,h,i,j,k,l=this;return a=b.apptools,i={resourceId:c.api+"."+c.method,url:c.action,data:JSON.stringify(c.payload()),async:c.ajax.async,global:c.ajax.global,type:c.ajax.http_method||"POST",accepts:c.ajax.accepts||"application/json",crossDomain:c.ajax.crossDomain,dataType:c.ajax.dataType,processData:!1,ifModified:c.ajax.ifModified,contentType:c.ajax.contentType,beforeSend:function(a,b){return $.apptools.api.rpc.history[c.envelope.id].xhr=a,d!=null&&typeof d.status=="function"&&d.status("beforeSend"),a},error:function(a,b,e){return d!=null&&typeof d.status=="function"&&d.status("error"),$.apptools.dev.error("RPC","Error: ",{error:e,status:b,xhr:a}),$.apptools.api.rpc.lastFailure=e,$.apptools.api.rpc.history[c.envelope.id].xhr=a,$.apptools.api.rpc.history[c.envelope.id].status=b,$.apptools.api.rpc.history[c.envelope.id].failure=e,f={xhr:a,status:b,error:e},$.apptools.events.trigger("RPC_ERROR",f),$.apptools.events.trigger("RPC_COMPLETE",f),d!=null?typeof d.failure=="function"?d.failure(e):void 0:void 0},success:function(a,b,e){return a.status==="ok"?(d!=null&&typeof d.status=="function"&&d.status("success"),$.apptools.dev.log("RPC","Success",a,b,e),$.apptools.api.rpc.lastResponse=a,$.apptools.api.rpc.history[c.envelope.id].xhr=e,$.apptools.api.rpc.history[c.envelope.id].status=b,$.apptools.api.rpc.history[c.envelope.id].response=a,f={xhr:e,status:b,data:a},$.apptools.events.trigger("RPC_SUCCESS",f),$.apptools.events.trigger("RPC_COMPLETE",f),d!=null?typeof d.success=="function"?d.success(a.response.content,a.response.type,a):void 0:void 0):a.status==="wait"?(d!=null&&typeof d.status=="function"&&d.status("wait"),$.apptools.dev.log("RPC","PushWait",a,b,e),f={xhr:e,status:b,data:a},d!=null&&typeof d.wait=="function"&&d.wait(a,b,e),$.apptools.push.internal.expect(c.envelope.id,c,e)):a.status==="fail"?(d!=null&&typeof d.status=="function"&&d.status("error"),$.apptools.dev.error("RPC","Error: ",{error:a,status:b,xhr:e}),$.apptools.api.rpc.lastFailure=a,$.apptools.api.rpc.history[c.envelope.id].xhr=e,$.apptools.api.rpc.history[c.envelope.id].status=b,$.apptools.api.rpc.history[c.envelope.id].failure=a,f={xhr:e,status:b,error:a},$.apptools.events.trigger("RPC_ERROR",f),$.apptools.events.trigger("RPC_COMPLETE",f),d!=null?typeof d.failure=="function"?d.failure(a):void 0:void 0):d!=null?typeof d.success=="function"?d.success(a.response.content,a.response.type,a):void 0:void 0},statusCode:{404:function(){return $.apptools.dev.error("RPC","HTTP/404","Could not resolve RPC action URI."),$.apptools.events.trigger("RPC_ERROR",{message:"RPC 404: Could not resolve RPC action URI.",code:404})},403:function(){return $.apptools.dev.error("RPC","HTTP/403","Not authorized to access the specified endpoint."),$.apptools.events.trigger("RPC_ERROR",{message:"RPC 403: Not authorized to access the specified endpoint.",code:403})},500:function(){return $.apptools.dev.error("RPC","HTTP/500","Internal server error."),$.apptools.events.trigger("RPC_ERROR",{message:"RPC 500: Woops! Something went wrong. Please try again.",code:500})}}},((j=$.apptools)!=null?(k=j.sys)!=null?k.drivers:void 0:void 0)?(e=$.apptools.sys.drivers.resolve("transport","amplify"),e!=null&&e===!0?($.apptools.dev.verbose("RPC","Fulfilling with AmplifyJS adapter."),h=e.request,g=h(i)):($.apptools.dev.verbose("RPC","Fulfilling with AJAX adapter.",i),g=$.ajax(i.url,i))):($.apptools.dev.verbose("RPC","Fulfilling with AJAX adapter.",i),g=$.ajax(i.url,i)),$.apptools.dev.verbose("RPC","Resulting XHR: ",g)}(d,e),{id:d.envelope.id,request:d}}},this.ext=null,this.registerAPIMethod=function(a,b,c,d){var e,f,g,h,i;if((h=$.apptools)!=null?(i=h.sys)!=null?i.drivers:void 0:void 0){e=$.apptools.sys.drivers.resolve("transport","amplify");if(e!==!1)return $.apptools.dev.log("RPCAPI",'Registering request procedure "'+a+"."+b+'" with AmplifyJS.'),g=a+"."+b,f={accepts:"application/json",type:"POST",dataType:"json",contentType:"application/json",url:this.api._assembleRPCURL(b,a,null,c),decoder:this.api.decodeRPCResponse},d.caching!=null?(d.caching===!0&&(f.caching="persist"),e.request.define(g,"ajax",f)):e.request.define(g,"ajax",f)}}}return z(b,a),b.name="CoreRPCAPI",b}(f),window.RPCAPI=t,window.RPCRequest=u,window.CoreRPCAPI=m,o=function(a){function b(a,b){var c=this;this.setUserInfo=function(a){return $.apptools.dev.log("UserAPI","Setting server-injected userinfo: ",a),c.current_user=a!=null?a.current_user:void 0}}return z(b,a),b.name="CoreUserAPI",b}(f),l=function(a){function b(a,b){var c=this;a.events.register("PUSH_INIT"),a.events.register("PUSH_READY"),a.events.register("PUSH_STATE_CHANGE"),a.events.register("PUSH_CHANNEL_OPEN"),a.events.register("PUSH_SOCKET_ESTABLISH"),a.events.register("PUSH_SOCKET_ACTIVITY"),a.events.register("PUSH_SOCKET_ACTIVITY_FINISH"),a.events.register("PUSH_SOCKET_ERROR"),a.events.register("PUSH_CHANNEL_CLOSE"),this.state={ready:!1,status:null,transport:{socket:null,channel:null},callbacks:{open:null,expect:null,activity:null,error:null,close:null},config:{token:null}},a.events.hook("PUSH_READY",function(){var a,b;return a=1<=arguments.length?x.call(arguments,0):[],(b=$.apptools.events).trigger.apply(b,["PUSH_STATE_CHANGE"].concat(x.call(a)))}),a.events.hook("PUSH_SOCKET_ESTABLISH",function(){var a,b;return a=1<=arguments.length?x.call(arguments,0):[],(b=$.apptools.events).trigger.apply(b,["PUSH_STATE_CHANGE"].concat(x.call(a)))}),a.events.hook("PUSH_SOCKET_ERROR",function(){var a,b;return a=1<=arguments.length?x.call(arguments,0):[],(b=$.apptools.events).trigger.apply(b,["PUSH_STATE_CHANGE"].concat(x.call(a)))}),a.events.hook("PUSH_CHANNEL_OPEN",function(){var a,b;return a=1<=arguments.length?x.call(arguments,0):[],(b=$.apptools.events).trigger.apply(b,["PUSH_STATE_CHANGE"].concat(x.call(a))),$.apptools.api.rpc.alt_push_response=!0}),a.events.hook("PUSH_CHANNEL_CLOSE",function(){var a,b;return a=1<=arguments.length?x.call(arguments,0):[],(b=$.apptools.events).trigger.apply(b,["PUSH_STATE_CHANGE"].concat(x.call(a))),$.apptools.api.rpc.alt_push_response=!1}),this.events={on_open:function(){return $.apptools.dev.verbose("PushSocket","Message transport opened."),c.state.status="ready",a.events.trigger("PUSH_CHANNEL_OPEN",c.state)},on_message:function(b){var d;return $.apptools.dev.verbose("PushSocket","Message received.",b),c.state.status="receiving",a.events.trigger("PUSH_SOCKET_ACTIVITY",c.state),typeof (d=c.state.callbacks).activity=="function"&&d.activity(b),a.events.trigger("PUSH_SOCKET_ACTIVITY_FINISH",c.state)},on_error:function(b){return $.apptools.dev.error("PushSocket","Message transport error.",b),c.state.status="error",a.events.trigger("PUSH_SOCKET_ERROR",c.state)},on_close:function(){return $.apptools.dev.verbose("PushSocket","Message transport closed."),c.state.status="close",c.state.ready=!1,a.events.trigger("PUSH_CHANNEL_CLOSE",c.state)}},this.internal={open_channel:function(b){return a.events.trigger("PUSH_INIT",b),c.state.config.token=b,c.state.transport.channel=new goog.appengine.Channel(c.state.config.token),c.internal},open_socket:function(){return c.state.transport.socket=c.state.transport.channel.open(),a.events.trigger("PUSH_SOCKET_ESTABLISH",c.state.transport.socket),c.state.transport.socket.onopen=c.events.on_open,c.state.transport.socket.onmessage=c.events.on_message,c.state.transport.socket.onerror=c.events.on_error,c.state.transport.socket.onclose=c.events.on_close,c.internal},listen:function(a){return c.state.callbacks=_.defaults(a,c.state.callbacks),c.state.ready=!0,c.internal},expect:function(a,b,d){var e,f;return(e=c.state)!=null&&(f=e.callbacks)!=null&&typeof f.expect=="function"&&f.expect(a,b,d),c.internal}},this.establish=function(a,b){return c.state.status="init",c.internal.open_channel(a).open_socket().listen(b),c}}return z(b,a),b.name="CorePushAPI",b}(f),a=function(){function a(a){var f=this;return this.sys={version:{major:0,minor:1,micro:4,build:4282012,release:"BETA"},state:null,platform:{},integrations:[],drivers:{transport:{},storage:{},render:{},register:function(a,b,c,d,e){return f.sys.drivers[a]={name:b,mount:c,registered:d,init:e},f}},go:function(){return f.dev.log("Core","All systems go."),f.sys.state="ready",f}},this.config={rpc:{base_uri:"/_api/rpc",host:null,enabled:!0},sockets:{host:null,enabled:!1}},this.state={},this.lib={},(a!=null?a.Modernizr:void 0)!=null&&(this.lib.modernizr=a.Modernizr,this.sys.integrations.push("modernizr"),this.load=function(a){return f.lib.modernizr.load(a)}),(a!=null?a.Backbone:void 0)!=null&&(this.lib.backbone=a.Backbone,this.sys.integrations.push("backbone"),e.prototype.apptools=this,c.prototype.apptools=this,d.prototype.apptools=this,b.prototype.apptools=this),(a!=null?a.Lawnchair:void 0)!=null&&(this.sys.integrations.push("lawnchair"),this.lib.lawnchair=a.Lawnchair),(a!=null?a.amplify:void 0)!=null&&(this.sys.integrations.push("amplify"),this.lib.amplify=a.amplify),(a!=null?a.jQuery:void 0)!=null&&(this.sys.integrations.push("jquery"),this.lib.jquery=a.jQuery),(a!=null?a.Milk:void 0)!=null&&(this.sys.integrations.push("milk"),this.lib.milk=a.Milk),(a!=null?a.Mustache:void 0)!=null&&(this.sys.integrations.push("mustache"),this.lib.mustache=a.Mustache),this.dev=new h(this,a),this.model=new k(this,a),this.events=new j(this,a),this.agent=new g(this,a),this.agent.discover(),this.dispatch=new i(this,a),this.api=new m(this,a),this.user=new o(this,a),this.push=new l(this,a),this.sys.go()}return a.name="AppTools",a}(),window.AppTools=a,window.apptools=new a(window),window.jQuery!=null?$.extend({apptools:window.apptools}):(window.$=function(a){return document.getElementById(a)},window.$.apptools=window.apptools)}).call(this);